{% extends "template.html" %}
{% load get_item %}

{% block title %}Wallstreet{% endblock %}
{% block h1 %}Wallstreet{% endblock %}

{% block content %}

{% for entry in ranking %}
<section class="corporation-row">
	<h2>
		<span class="corporation-index">{{ forloop.counter }}</span>
		<span class="corporation-name">{{ entry.0.base_corporation.name }}</span>
		<span class="current-assets">{{ entry.0.assets }}
			<span class="assets-delta{{ entry.0.asset_delta_is_positive|yesno:" positive, negative,"}}">
			{{ entry.0.asset_delta|default:"-" }}
			</span>
		</span>
	</h2>

	<div class="corporation-markets">
	{% for corporation_market in entry.1 %}
		<div class="corporation-market">
			<img src="{{ STATIC_URL }}{{ CITY }}/markets/{{ corporation_market.market.name}}.png" title={{ corporation_market.market.name }} />
			<span class="corporation-market-value">{{ corporation_market.value }}</span>
			<span class="corporation-market-bubble">{{ corporation_market.bubble_value }}</span>
		</div>
	{% endfor %}
	</div>
</section>
{% endfor %}

{% endblock content %}

{% block scripts %}
{% regroup assets_history by turn as assets_history_turn %}

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("visualization", "1", {packages:["corechart"]});
google.setOnLoadCallback(drawChart);
function drawChart() {
	var data = google.visualization.arrayToDataTable([
	['Tour',
		{% for c in sorted_corporations %}
			'{{c.base_corporation.name}}',
		{% endfor %}
	],
	{% for assets in assets_history_turn %}
	['Tour #{{ assets.grouper }}',
		{% for a in assets.list %}
			{{a.assets}},
		{% endfor %}
	],
	{% endfor %}
	]);

	var options = {
		title: 'Wallstreet',
		backgroundColor: 'transparent',
		pointSize: 4,
		curveType: 'function',
	};

	var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
	chart.draw(data, options);
}

window.onresize = drawChart;
</script>
{% endblock scripts %}


