{% extends "template.html" %}
{% block title %}Ordres du tour{% endblock %}
{% block h1 %}Ordres du tour{% endblock %}

{% block content %}

<script type="text/javascript">
// set up a new XMLHttpRequest variable
var request = false;
request = new XMLHttpRequest();
 
if (!request)
	alert("Error initializing XMLHttpRequest!");
 
function get_targets(sel) {
	var stealer_corporation = sel.value;
	var url = window.location.href + "/get_targets/" + escape(stealer_corporation);
	request.open("GET", url, true);
	request.onreadystatechange = updatePage;
	request.send(null);
} 
 
// what to do when http ready state changes
function updatePage() { 
	if (request.readyState == 4) {
		if (request.status == 200) {
  
			// get response array
			var data = JSON.parse(request.responseText); 
			update_select($('select[name=target_corporation_market]'), data);
		}
		// some error checking
		else if (request.status == 404) {
			alert("Request url does not exist");
		}
		else {
			alert("Error: status code is " + request.status);
		}
	}
}

function update_select(select, data) {
	select.find('option').remove();
	select.append('<option value="" selected="selected">---------</option>')
	for (var k in data) {
		select.append($('<option value="'+k+'">'+data[k]+'</option>'));
	}
}
</script>

{% if existing_orders|length > 0 %}
<table class="order-launched">
<thead>
	<tr>
		<th></th>
		<th colspan="3">Ordre</th>
		<th>Coût</th>
	</tr>
</thead>
<tfoot>
	<tr>
		<td class="total-text" colspan="4">TOTAL</td>
		<td class="total-total">{{ existing_orders_cost }}k&nbsp;₵</td>
	</tr>
</tfoot>
<tbody>
{% for order in existing_orders %}
<tr>
	<td class="order-delete"><a href="{% url "website.views.orders.delete_order" game_id=game.pk order_id=order.pk %}" title="Supprimer cet ordre">✗</a></td>
	<td class="order-name"><svg role="img" class="svg--medium svg--white" title="{{ order.title }}"><use xlink:href="/static/img/sprite.svg#{{ order.name }}"></use></svg>
	{% if order.custom_description|length == 0 %}
	<td colspan="2" class="order-description">{{ order.description }}</td>
	{% else %}
	<td class="order-description">{{ order.description }}</td>
	<td class="order-custom">{{ order.custom_description }}</td>
	{% endif %}
	<td class="order-cost">{% if order.get_cost > 0 %}{{ order.get_cost }}k&nbsp;₵{% else %}-{% endif %}</td>
</tr>
{% endfor %}
</tbody>
</table>
{% endif %}

<h1 class="main-h1-title">Passer un ordre</h1>

<ul class="content-order-list">
{% for order in available_orders %}
	<li{% if order.available == False %} class="disabled" title="{{order.reason }}"{% endif %}>
		<svg role="img" class="svg--large svg--white" title="{{ order.title }}"><use xlink:href="/static/img/sprite.svg#{{ order.name }}"></use></svg>
		<h2>{{ order.title }}</h2>
	</li>
{% endfor %}
</ul>

<div class="dropdown">
<ul>
	<li>
		<a href="">Corporations</a>
		<ul>
			<li>
				<a href="">Bastion</a>
				<ul>
					<li><a href="">Télécom</a></li>
					<li><a href="">Énergie</a></li>
					<li><a href="">Agroalimentaire</a></li>
					<li><a href="">Militaire</a></li>
				</ul>
			</li>
			<li>
				<a href="">CityGroup</a>
				<ul>
					<li><a href="">BTP</a></li>
					<li><a href="">Robotique</a></li>
					<li><a href="">Agroalimentaire</a></li>
				</ul>
			</li>
			<li>
				<a href="">EnerCore</a>
				<ul>
					<li><a href="">BTP</a></li>
					<li><a href="">Médias</a></li>
					<li><a href="">Énergie</a></li>
				</ul>
			</li>
		</ul>
	</li>
</ul>
</div>
<!--
	<li>
		<a href="">Reptiles</a>
		<ul>
			<li><a href="">Lizards and snakes</a></li>
			<li><a href="">Tortoises and turtles</a></li>
			<li><a href="">Crocodilians</a></li>
			<li><a href="">Tuatara</a></li>
		</ul>
	</li>
	<li>
		<a href="">Amphibians</a>
		<ul>
			<li><a href="">Frogs and toads</a></li>
			<li><a href="">Salamanders and newts</a></li>
			<li><a href="">Caecilians</a></li>
		</ul>
	</li>
</ul>
</div>
-->
{% for order in available_orders %}
	<div class="order-form-content">
		<div class="content-title">
<!--			<h3 style="background-image: url('{{STATIC_URL }}orders/{{ order.name }}.png')" class="order">
-->			<h3 style="background-image: /static/img/sprite.svg#{{ order.name }}" class="order">
				<span>{{ order.title }}</span>
			</h3>
		</div>
	{% if order.available != False %}
	<form class="order-form-container" method="post" action="{% url "website.views.orders.add_order" game_id=game.pk order_type=order.name %}">
		<table>
		{{ order.info }}
		{{ order.form.as_table }}
		<tr class="submit-order" type="hidden">
			<td colspan="2">
				<div class="button-content">
					<div class="cornered-top"></div>
					<input type="submit" value="Envoyer l'ordre" />
					<div class="cornered-bottom"></div>
				</div>
			</td>
		</tr>
		</table>
	</form>
	{% else %}
	<div class="order-form-container">
		{{ order.reason }}
	</div>
	{% endif %}
	</div>
{% endfor %}

{% endblock content %}
